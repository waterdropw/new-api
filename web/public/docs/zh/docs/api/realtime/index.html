<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>实时语音（Realtime）接口</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="../shared.css" />
  </head>
  <body>
    <main class="page">
      <nav class="breadcrumb">
        <a href="/docs/zh/docs/api/index.html">API 参考</a>
        <span>/</span>
        <span>实时语音</span>
      </nav>

      <header class="endpoint-header">
        <div>
          <span class="method-badge method-badge-ws">WebSocket</span>
          <code class="endpoint-path"><span>/</span>v1<span>/</span>realtime</code>
        </div>
        <h1>实时语音（Realtime）</h1>
        <p class="subtitle">流式音频 / 实时对话接口，低延迟语音对话体验</p>
      </header>

      <section class="section">
        <h2 class="section-title">接口说明</h2>
        <p class="section-desc">
          实时语音接口用于构建低延迟的语音对话体验，通过 WebSocket 方式提供连续音频流。适用于实时语音助手、实时翻译等需要低延迟音频交互的场景。
        </p>
        <div class="info-box">
          该接口使用 WebSocket 协议，不是标准的 HTTP REST 接口。需要使用支持 WebSocket 的客户端进行连接。
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">认证</h2>
        <p class="section-desc">通过查询参数或请求头传递认证信息：</p>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>方式</th>
                <th>格式</th>
                <th>说明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>查询参数</td>
                <td><code>?token=sk-xxxxxx</code></td>
                <td>在 WebSocket URL 中附加 token 参数</td>
              </tr>
              <tr>
                <td>请求头</td>
                <td><code>Authorization: Bearer sk-xxxxxx</code></td>
                <td>部分 WebSocket 客户端支持自定义请求头</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">连接参数</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>参数</th>
                <th>类型</th>
                <th>必需</th>
                <th>说明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>model</code></td>
                <td>string (query)</td>
                <td><span class="required">是</span></td>
                <td>模型名称，如 gpt-4o-realtime-preview</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">连接示例</h2>
        <div class="code-block">
          <div class="code-header">JavaScript</div>
          <div class="code-content">
            <pre><code>const ws = new WebSocket(
  'wss://your-base-url/v1/realtime?model=gpt-4o-realtime-preview',
  ['realtime', 'openai-insecure-api-key.sk-xxxxxx', 'openai-beta.realtime-v1']
);

ws.onopen = function() {
  console.log('连接已建立');

  // 发送会话配置
  ws.send(JSON.stringify({
    type: 'session.update',
    session: {
      modalities: ['text', 'audio'],
      instructions: '你是一个友好的语音助手',
      voice: 'alloy',
      input_audio_format: 'pcm16',
      output_audio_format: 'pcm16',
      turn_detection: {
        type: 'server_vad'
      }
    }
  }));
};

ws.onmessage = function(event) {
  const data = JSON.parse(event.data);
  console.log('收到消息:', data.type);

  switch (data.type) {
    case 'session.created':
      console.log('会话已创建');
      break;
    case 'response.audio.delta':
      // 处理音频数据
      break;
    case 'response.text.delta':
      // 处理文本数据
      break;
  }
};

ws.onerror = function(error) {
  console.error('WebSocket 错误:', error);
};

ws.onclose = function() {
  console.log('连接已关闭');
};</code></pre>
          </div>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">cURL 连接示例</h2>
        <div class="code-block">
          <div class="code-header">cURL (websocat)</div>
          <div class="code-content">
            <pre><code># 使用 websocat 工具连接
websocat "wss://your-base-url/v1/realtime?model=gpt-4o-realtime-preview" \
  -H "Authorization: Bearer sk-xxxxxx"</code></pre>
          </div>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">事件类型</h2>
        <p class="section-desc">WebSocket 通信基于事件消息，以下是常用的事件类型：</p>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>事件</th>
                <th>方向</th>
                <th>说明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>session.update</code></td>
                <td>客户端 → 服务端</td>
                <td>更新会话配置（语音、模态、指令等）</td>
              </tr>
              <tr>
                <td><code>session.created</code></td>
                <td>服务端 → 客户端</td>
                <td>会话创建成功</td>
              </tr>
              <tr>
                <td><code>input_audio_buffer.append</code></td>
                <td>客户端 → 服务端</td>
                <td>追加音频数据到输入缓冲区</td>
              </tr>
              <tr>
                <td><code>input_audio_buffer.commit</code></td>
                <td>客户端 → 服务端</td>
                <td>提交音频缓冲区</td>
              </tr>
              <tr>
                <td><code>response.create</code></td>
                <td>客户端 → 服务端</td>
                <td>请求生成响应</td>
              </tr>
              <tr>
                <td><code>response.audio.delta</code></td>
                <td>服务端 → 客户端</td>
                <td>音频响应增量数据</td>
              </tr>
              <tr>
                <td><code>response.text.delta</code></td>
                <td>服务端 → 客户端</td>
                <td>文本响应增量数据</td>
              </tr>
              <tr>
                <td><code>response.done</code></td>
                <td>服务端 → 客户端</td>
                <td>响应完成</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </main>
  </body>
</html>
